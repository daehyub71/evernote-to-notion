# ENEX 파일 실제 분석 결과

**분석 일시**: 2025-10-25
**소스 디렉토리**: `/Users/sunchulkim/evernote`

## 요약

```
총 ENEX 파일: 23개
총 노트: 1,373개
총 리소스: 1,574개
총 용량: ~450MB

리소스 분포:
- 리소스 있는 파일: 17개 (73.9%)
- 리소스 없는 파일: 6개 (26.1%)
```

## 파일별 상세 현황

| 파일명 | 노트 수 | 리소스 수 | 용량 | 비고 |
|--------|---------|-----------|------|------|
| 블로그_예전모음.enex | 60 | 1,192 | 160MB | ⚠️ 전체 리소스의 75.7% |
| 책정리.enex | 413 | 87 | 116MB | 노트 최다 |
| 첫 번째 노트북.enex | 204 | 49 | 13.7MB | |
| 블랙야크.enex | 103 | 68 | 29MB | |
| 일상이야기.enex | 92 | 16 | 19.2MB | |
| 미국출장이야기.enex | 80 | 25 | 31MB | |
| 그냥 이야기.enex | 73 | 22 | 7.6MB | |
| ETF 바이브 코딩.enex | 64 | 32 | 5.9MB | |
| 주간일기.enex | 64 | 1 | 0.6MB | |
| IT트렌드.enex | 45 | 21 | 4.2MB | |
| 책 작성.enex | 44 | 33 | 56.9MB | |
| 직장이야기.enex | 29 | 4 | 2.6MB | |
| 투자생각정리.enex | 26 | 13 | 4.1MB | |
| 책초안_2505.enex | 14 | 7 | 0.9MB | |
| 부동산분석('25.06).enex | 8 | 1 | 1.4MB | |
| 냅킨경제학.enex | 3 | 2 | 0.9MB | |
| 돌봄학개론.enex | 3 | 1 | 3.5MB | |
| **리소스 없는 파일 (6개)** | | | | |
| 맛집.enex | 3 | 0 | 5.6KB | |
| 삶의태도.enex | ? | 0 | 60.6KB | |
| 용어정리.enex | ? | 0 | 10.5KB | |
| 프롬프트 모음.enex | ? | 0 | 83.4KB | |
| 금융데이터 Vibe 코딩 아이디어.enex | ? | 0 | 0.5MB | |
| KBO 세이브매트릭스.enex | ? | 0 | 58.5KB | |

## 리소스 포맷 분석

### MIME Type 분포

| MIME Type | 개수 | 비율 | 처리 전략 |
|-----------|------|------|-----------|
| **이미지** | | | |
| image/jpeg | 1,383 | 87.9% | Notion `image` 블록 |
| image/png | 160 | 10.2% | Notion `image` 블록 |
| image/svg+xml | 13 | 0.8% | Notion `image` 블록 (SVG 지원) |
| image/webp | 1 | 0.1% | Pillow로 PNG 변환 후 `image` 블록 |
| **소계** | **1,557** | **98.9%** | |
| **문서** | | | |
| application/pdf | 11 | 0.7% | Notion `file` 또는 `pdf` 블록 |
| application/vnd.openxmlformats-officedocument.wordprocessingml.document | 1 | 0.1% | Notion `file` 블록 (DOCX) |
| application/vnd.openxmlformats-officedocument.presentationml.presentation | 1 | 0.1% | Notion `file` 블록 (PPTX) |
| **소계** | **13** | **0.8%** | |
| **텍스트** | | | |
| text/markdown | 3 | 0.2% | Notion `code` 블록 (언어: markdown) |
| text/plain | 1 | 0.1% | Notion `code` 블록 (언어: text) |
| **소계** | **4** | **0.3%** | |
| **총계** | **1,574** | **100%** | |

### 카테고리별 요약

- **이미지**: 1,557개 (98.9%) - 메인 워크로드
- **문서**: 13개 (0.8%) - PDF/Office 파일 처리 필요
- **텍스트**: 4개 (0.3%) - 코드 블록으로 표시 가능

## 리소스 구조 분석

### 샘플 리소스 XML

```xml
<resource>
  <data encoding="base64">iVBORw0KGgoAAAANSUhEUgAA...</data>
  <mime>image/jpeg</mime>
  <width>840</width>
  <height>2289</height>
  <resource-attributes>
    <file-name>Screenshot_20221015_235500_ramblr.jpg</file-name>
    <source-url>en-cache://tokenKey%3D%22AuthToken%3AUser%3A98445293%22+8cc75b80-e115-bfb4-2c4e-554157d6a7a9+34c08f36cde832639fdf3190a3786b4d+https%3A%2F%2Fpublic.www.evernote.com%2Fresources%2Fs554%2F20519767-d15c-7ed4-a0de-3507243d9265</source-url>
  </resource-attributes>
</resource>
```

### ENML 본문에서의 참조

```xml
<en-media style="--en-viewAs:attachment;"
         hash="34c08f36cde832639fdf3190a3786b4d"
         type="image/jpeg" />
```

### 매칭 메커니즘

1. 리소스의 `<data>` Base64 디코딩
2. 디코딩된 바이너리의 MD5 해시 계산
3. ENML `<en-media hash="...">` 속성과 매칭
4. 모든 리소스는 **반드시 이 해시로 참조됨**

## 핵심 발견

### 1. 극단적 리소스 분포
- **블로그_예전모음.enex**: 1,192개 (전체의 75.7%)
- 나머지 16개 파일: 382개 (24.3%)
- 단일 파일 처리 실패 시 전체 프로젝트 영향 큼

### 2. 이미지 중심 데이터
- 98.9%가 이미지 → 이미지 업로드 전략이 핵심
- PDF/Office 문서는 소량 → 별도 처리 가능

### 3. 메타데이터 완전성
- **파일명**: 1,574개 모두 `file-name` 속성 보유
- **원본 URL**: 대부분 `source-url` 속성 보유
- **이미지 크기**: 이미지는 모두 `width`, `height` 속성 보유

### 4. 처리 복잡도

**예상 API 호출 수**:
```
- 노트 페이지 생성: 1,373회
- 리소스 업로드 참조: 1,574회
- 블록 추가 (노트당 평균 10개 블록): 13,730회
----------------------------------------------
총 API 호출: 약 16,677회

Notion API 제한 (초당 3회):
- 최소 소요 시간: 16,677 / 3 = 5,559초 ≈ 93분 (1.5시간)
- 재시도 및 오버헤드 고려: 8-10시간
```

## 기술적 도전과제

### 1. 블로그_예전모음.enex 처리
- 1,192개 리소스를 안정적으로 업로드
- 메모리 효율적 파싱 (160MB XML)
- 실패 시 체크포인트 복원

### 2. 파일 호스팅 전략
- 1,574개 파일 (예상 500MB-1GB)을 어디에 저장?
- 옵션:
  - AWS S3 (~$1-2/월)
  - Cloudinary 무료 티어 (25GB/월)
  - Imgur (무료, 이미지만)

### 3. MD5 해시 매칭
- 1,373개 노트 × 평균 1-2개 리소스 = O(n) 조회
- 해시 딕셔너리로 O(1) 최적화 필요

### 4. 파일 포맷 다양성
- 9가지 MIME 타입 처리
- WebP → PNG 변환 필요
- SVG Notion 지원 확인 필요

## 권장 사항

### Phase 1: 소규모 테스트
- 리소스 없는 파일부터 (맛집.enex 등 6개)
- 텍스트 마이그레이션 로직 검증

### Phase 2: 중간 규모 테스트
- 리소스 소량 파일 (냅킨경제학.enex 2개, 돌봄학개론.enex 1개)
- 이미지 업로드 전략 검증

### Phase 3: 대규모 처리
- 블로그_예전모음.enex를 제외한 나머지 먼저
- 성공 후 마지막으로 블로그_예전모음.enex 처리

### 파일 처리 우선순위

**Tier 1: 리소스 없음 (검증용)**
- 맛집.enex (3 노트, 0 리소스)
- 삶의태도.enex, 용어정리.enex 등

**Tier 2: 리소스 소량 (테스트용)**
- 냅킨경제학.enex (3 노트, 2 리소스)
- 돌봄학개론.enex (3 노트, 1 리소스)
- 부동산분석.enex (8 노트, 1 리소스)

**Tier 3: 중간 규모**
- 직장이야기.enex (29 노트, 4 리소스)
- 투자생각정리.enex (26 노트, 13 리소스)
- IT트렌드.enex (45 노트, 21 리소스)
- 책 작성.enex (44 노트, 33 리소스)

**Tier 4: 대규모 (노트 많음)**
- 책정리.enex (413 노트, 87 리소스)
- 첫 번째 노트북.enex (204 노트, 49 리소스)
- 블랙야크.enex (103 노트, 68 리소스)

**Tier 5: 최종 보스 ⚠️**
- 블로그_예전모음.enex (60 노트, 1,192 리소스, 160MB)

## 결론

**파서 설계는 충분한가?**

**예** - 하지만 중요한 발견:

1. ✅ **기본 구조 파악 완료**: ENEX XML, ENML, 리소스 구조
2. ✅ **리소스 포맷 파악**: 9가지 MIME 타입 확인
3. ✅ **MD5 해시 매칭 메커니즘** 이해
4. ⚠️ **1,574개 리소스 업로드가 핵심 난제** (계획서에 반영됨)
5. ⚠️ **블로그_예전모음.enex 하나가 75.7%** - 실패 시 영향 큼

**추가로 고려해야 할 사항**:

1. **Phase 4 (리소스 처리)가 가장 중요** - 3-4일 → 4-5일 권장
2. **파일 호스팅 전략을 Phase 4 초반에 결정** - AWS S3 vs Cloudinary
3. **체크포인트 시스템 필수** - 8-10시간 실행 중 중단 가능
4. **Tier별 점진적 처리 전략** - 작은 파일부터 테스트

---

**분석 완료**: 2025-10-25
**다음 단계**: Phase 1 개발 시작
